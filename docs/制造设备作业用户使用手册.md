# Odoo 18 MrpWorkOrder 扩展模块用户使用手册

## 一、引言
本用户使用手册旨在帮助你了解并使用基于 Odoo 18 原生模块扩展的 `MrpWorkOrder` 模块。该扩展模块为制造工单管理提供了额外的功能，包括设备作业单关联、生产数量计算、检验合格数量统计等。通过本手册，你将了解到如何进行各种操作以及这些功能的使用方法。

## 二、模块功能概述

### （一）设备作业单关联
`MrpWorkOrder` 类中通过 `equipment_work_order_ids` 字段实现了与设备作业单的关联，你可以方便地查看和管理与制造工单相关的设备作业单。

### （二）生产数量计算
1. `qty_produced` 字段用于记录已生产的产品数量，它会根据设备作业单的相关数据进行计算。
2. `scheduled_work_order_qty` 字段表示已安排的生产数量，同样是根据设备作业单的状态和数量计算得出。
3. `produce_qualified_qty` 字段用于统计工序检验合格的产品数量。

### （三）编程标识
`programming` 字段是一个布尔类型的字段，与 `operation_id` 的编程属性相关联，用于标识该工单是否需要编程。

### （四）其他功能
1. 生成设备作业单：可以根据制造工单生成对应的设备作业单，并进行确认操作。
2. 时间线值准备：在准备时间线值时，会更新设备作业单的相关信息。
3. 取消工单：取消制造工单时，会同时取消关联的设备作业单。
4. 检查前序工单：在生产过程中，可以检查前序工单的完成数量和合格数量，以确保生产数量不超过前序工序的限制。
5. 自动消耗原材料：在工单完成时，会自动消耗已分配的原材料。

## 三、操作步骤

### （一）创建制造工单
在 Odoo 18 系统中，进入制造模块，按照以下步骤创建制造工单：
1. 导航到“制造”菜单，选择“工单”选项。
2. 点击“创建”按钮，进入工单创建页面。
3. 填写工单的基本信息，如产品、数量、计划开始日期、计划结束日期等。
4. 选择相关的工作中心和操作。
5. 如果该工单需要编程，确保 `operation_id` 的编程属性已正确设置，`programming` 字段会自动关联显示。

### （二）生成设备作业单
1. 在制造工单列表中，选择你要生成设备作业单的工单。
2. 点击“操作”按钮，在下拉菜单中选择“生成设备作业单向导”。
3. 系统会弹出一个向导窗口，你可以在该窗口中设置设备作业单的相关参数，如安排数量、指定设备、团队等。
    - 安排数量（`product_qty`）：输入设备作业单的安排生产数量，如果不输入，系统会默认使用工单的生产数量。
    - 指定设备（`equipment_id`）：选择设备作业单要使用的设备，如果不选择，系统会使用默认设备。
    - 团队（`team_id`）：选择设备作业单所属的团队，如果不选择，系统会使用默认团队。
    - 计划开始日期（`plan_start`）和计划结束日期（`plan_finish`）：输入设备作业单的计划开始和结束日期，如果不输入，系统会使用工单的计划日期。
4. 点击“确认”按钮，系统会生成设备作业单并自动进行确认操作。

### （三）查看设备作业单
1. 在制造工单详情页面，你可以看到“设备作业单”相关的信息，点击“设备作业单”标签页。
2. 该标签页会显示与该工单关联的所有设备作业单列表，包括设备作业单的编号、设备名称、安排数量、已生产数量、状态等信息。
3. 你可以点击设备作业单的编号，进入设备作业单详情页面，查看更详细的信息。

### （四）确认设备作业单
如果设备作业单生成后需要手动确认，可以按照以下步骤进行操作：
1. 在设备作业单列表中，选择你要确认的设备作业单。
2. 点击“操作”按钮，在下拉菜单中选择“确认”。
3. 系统会将设备作业单的状态更新为“已确认”。

### （五）取消工单
如果需要取消制造工单，可以按照以下步骤进行操作：
1. 在制造工单列表中，选择你要取消的工单。
2. 点击“操作”按钮，在下拉菜单中选择“取消”。
3. 系统会弹出确认窗口，提示你确认取消操作。点击“确认”按钮，系统会取消该工单，并同时取消关联的设备作业单。

### （六）检查前序工单
在生产过程中，如果你需要检查前序工单的完成数量和合格数量，可以按照以下步骤进行操作：
1. 在制造工单详情页面，点击“检查前序工单”按钮。
2. 系统会自动检查前序工单的完成数量和合格数量，如果生产数量超过前序工序的限制，系统会弹出错误提示信息。

### （七）完成工单
当工单生产完成后，需要进行以下操作：
1. 在制造工单列表中，选择你要完成的工单。
2. 点击“操作”按钮，在下拉菜单中选择“完成”。
3. 系统会自动调用 `button_finish` 方法，完成以下操作：
    - 调用父类的 `button_finish` 方法，完成工单的基本完成操作。
    - 自动消耗已分配的原材料，确保原材料的库存数量正确更新。
    - 检查关联的设备作业单状态，如果有未完成的设备作业单，系统会自动将其状态更新为“已关闭”。

## 四、注意事项

### （一）生产数量限制
在生产过程中，要注意生产数量不能超过前序工序的完成数量和合格数量，否则系统会弹出错误提示信息，无法继续生产。

### （二）设备作业单状态
在生成设备作业单后，要及时确认设备作业单的状态，确保设备作业单的状态与实际生产情况一致。

### （三）原材料消耗
在工单完成时，系统会自动消耗已分配的原材料，因此在工单创建时，要确保原材料的分配数量正确，避免出现库存异常的情况。

## 五、总结
通过本用户使用手册，你应该已经了解了 `MrpWorkOrder` 扩展模块的主要功能和操作步骤。在使用过程中，如果遇到任何问题，请及时联系系统管理员或开发人员。希望本手册能帮助你更好地使用该模块，提高制造工单管理的效率和准确性。